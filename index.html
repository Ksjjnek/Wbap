<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Casino Web App Improved</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 20px;
}
.toggle {
    display: flex;
    width: 220px;
    border-radius: 30px;
    background: #333;
    margin-bottom: 20px;
    cursor: pointer;
}
.toggle div {
    flex: 1;
    text-align: center;
    padding: 12px 0;
    transition: all 0.3s;
    font-weight: bold;
}
.toggle .active {
    background: #f39c12;
    color: #000;
    border-radius: 30px;
}
.game-area {
    width: 360px;
    height: 400px;
    background: #222;
    margin-bottom: 20px;
    border-radius: 10px;
    position: relative;
    overflow: hidden;
    border: 2px solid #444;
}
.controls {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
    align-items: center;
}
.control-group {
    width: 100%;
}
.control-group p {
    margin: 0 0 5px 0;
    font-size: 14px;
    color: #ccc;
    text-align: center;
}
.buttons {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    justify-content: center;
}
button {
    padding: 10px 15px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
    background: #333;
    color: #fff;
}
button:hover { background: #f39c12; color: #000; }
button.selected { background: #f39c12; color: #000; }
#play { width: 80%; margin-top: 10px; font-size: 16px; }
#betCost { font-weight: bold; color: #f39c12; }
.ball { width: 12px; height: 12px; border-radius: 50%; background: #f39c12; position: absolute; top: 0; left: 50%; transform: translateX(-50%); z-index: 2; }
.prize {
    width: 40px;
    height: 28px;
    position: absolute;
    bottom: 0;
    border-radius: 5px;
    background: #444;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 11px;
    transition: background 0.3s;
}
.prize.win { background: #f39c12; }
.pin { width: 8px; height: 8px; background: #888; border-radius: 50%; position: absolute; }
</style>
</head>
<body>

<div class="toggle">
    <div class="active" id="demo">Демо</div>
    <div id="balance">Баланс</div>
</div>

<div class="game-area" id="gameArea">
    <!-- Призовые зоны -->
    <div class="prize" style="left:0%">0x</div>
    <div class="prize" style="left:12%">0.1x</div>
    <div class="prize" style="left:24%">0.5x</div>
    <div class="prize" style="left:36%">0.75x</div>
    <div class="prize" style="left:48%">1x</div>
    <div class="prize" style="left:60%">1.5x</div>
    <div class="prize" style="left:72%">2x</div>
    <div class="prize" style="left:84%">2.5x</div>
    <div class="prize" style="left:96%">5x</div>
</div>

<div class="controls">
    <div class="control-group">
        <p>Количество шариков</p>
        <div class="buttons" id="balls">
            <button>1</button><button>2</button><button>5</button><button>10</button><button>25</button><button>50</button>
        </div>
    </div>
    <div class="control-group">
        <p>Выбор ставки</p>
        <div class="buttons" id="bet">
            <button>10</button><button>50</button><button>100</button>
        </div>
    </div>
    <button id="play">Играть</button>
    <p>Стоимость ставки: <span id="betCost">10</span>₽</p>
</div>

<script>
const toggle = document.querySelector('.toggle');
const demo = document.getElementById('demo');
const balance = document.getElementById('balance');
let mode='demo';
toggle.addEventListener('click', e=>{
    if(e.target.id==='demo'){demo.classList.add('active');balance.classList.remove('active');mode='demo'}
    else if(e.target.id==='balance'){balance.classList.add('active');demo.classList.remove('active');mode='balance'}
});
document.querySelectorAll('#balls button').forEach(btn=>btn.addEventListener('click',()=>{document.querySelectorAll('#balls button').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');}));
document.querySelectorAll('#bet button').forEach(btn=>btn.addEventListener('click',()=>{document.querySelectorAll('#bet button').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');document.getElementById('betCost').innerText=btn.innerText;}));

const gameArea=document.getElementById('gameArea');
const prizes=Array.from(document.querySelectorAll('.prize'));

// Треугольная сетка пинов
const pins=[];
const rows=6;
const spacingX=50;
const spacingY=50;
for(let r=0;r<rows;r++){
    let cols=r+1;
    for(let c=0;c<cols;c++){
        let pin=document.createElement('div');
        pin.classList.add('pin');
        pin.style.left=(gameArea.clientWidth/2-(cols-1)*spacingX/2 + c*spacingX)+'px';
        pin.style.top=(50+r*spacingY)+'px';
        gameArea.appendChild(pin);
        pins.push(pin);
    }
}

function dropBall(){
    const ballsCount=parseInt(document.querySelector('#balls button.selected')?.innerText||'1');
    const betAmount=parseInt(document.querySelector('#bet button.selected')?.innerText||'10');

    for(let i=0;i<ballsCount;i++){
        const ball=document.createElement('div');
        ball.classList.add('ball');
        gameArea.appendChild(ball);

        // Старт по центру игрового поля
        let posX = gameArea.clientWidth/2 - 6;
        let posY = 0;

        let velocityX = (Math.random()-0.5)*1;
        let velocityY = 1;
        const gravity = 0.15;
        const friction = 0.7;

        const interval = setInterval(()=>{
            velocityY += gravity;
            posX += velocityX;
            posY += velocityY;

            // Отскок от пинов
            pins.forEach(pin=>{
                let dx=(posX+6)-(pin.offsetLeft+4);
                let dy=(posY+6)-(pin.offsetTop+4);
                let dist=Math.sqrt(dx*dx+dy*dy);
                if(dist<10){
                    let angle=Math.atan2(dy,dx);
                    let speed=Math.sqrt(velocityX*velocityX+velocityY*velocityY)*friction;
                    velocityX=-speed*Math.cos(angle);
                    velocityY=-speed*Math.sin(angle);
                }
            });

            // Столкновения со стенками
            if(posX<0){posX=0;velocityX=-velocityX*friction}
            if(posX>gameArea.clientWidth-12){posX=gameArea.clientWidth-12;velocityX=-velocityX*friction}
            if(posY>gameArea.clientHeight-12){posY=gameArea.clientHeight-12;velocityY=-velocityY*friction}

            ball.style.transform=`translate(${posX}px,${posY}px)`;

            // Проверка попадания в призовые зоны
            prizes.forEach(prize=>{
                let px=prize.offsetLeft;
                let py=prize.offsetTop;
                let pw=prize.offsetWidth;
                let ph=prize.offsetHeight;
                if(posX+6>px && posX<px+pw && posY+6>py && posY<py+ph){
                    prize.classList.add('win');
                    clearInterval(interval);
                    setTimeout(()=>{ball.remove();prize.classList.remove('win');},500);
                    if(window.Telegram?.WebApp){
                        Telegram.WebApp.sendData(JSON.stringify({mode,balls:ballsCount,bet:betAmount,prize:prize.innerText}));
                    }
                }
            });

        },20);
    }
}
document.getElementById('play').addEventListener('click',dropBall);
</script>

</body>
</html>
