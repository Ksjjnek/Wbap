<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #1c1c1d;
            --card-bg: #2c2c2e;
            --accent-color: #0088cc;
            --text-main: #ffffff;
            --text-secondary: #aaaaaa;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            position: relative;
            z-index: 100;
        }

        .mode-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .profile-trigger {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: #444 linear-gradient(45deg, #555, #333);
            object-fit: cover;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 101;
            border: 2px solid rgba(255,255,255,0.1);
        }

        /* --- PROFILE SCREEN --- */
        #profile-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            z-index: 90;
        }

        .profile-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(25px) brightness(0.3);
            transform: scale(1.2);
            transition: background-image 0.5s ease;
        }

        .profile-content {
            position: relative;
            text-align: center;
            z-index: 92;
            width: 100%;
        }

        .user-nick {
            color: var(--accent-color);
            font-size: 16px;
            margin-bottom: 5px;
            display: block;
        }

        .user-name {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 25px;
        }

        .balance-card {
            background: rgba(255,255,255,0.08);
            padding: 20px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            margin: 10px 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* --- MAIN MENU --- */
        #menu-screen {
            padding: 20px;
            transition: opacity 0.3s;
        }

        .game-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 18px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }

        .game-preview {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #0088cc, #005588);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
        }

        .game-info { flex: 1; }
        .game-title { font-size: 20px; font-weight: 700; }
        
        /* --- GAME SCREEN (CUBE) --- */
        #game-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 70vh;
        }

        /* –ö—É–±–∏–∫ */
        .jump-box { position: relative; transition: transform 1.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .scene { width: 100px; height: 100px; perspective: 1000px; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1.5s cubic-bezier(0.15, 0.8, 0.4, 1); transform: rotateX(-20deg) rotateY(20deg); }
        .cube__face { position: absolute; width: 100px; height: 100px; border: 2px solid rgba(255,255,255,0.3); line-height: 100px; font-size: 40px; font-weight: bold; text-align: center; background: rgba(255,255,255,0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; transition: 0.4s; }
        .cube__face.winner { background: #fff !important; color: #000 !important; box-shadow: 0 0 40px rgba(255,255,255,0.5); }
        .cube__face--1 { transform: rotateY(0deg) translateZ(50px); }
        .cube__face--2 { transform: rotateY(180deg) translateZ(50px); }
        .cube__face--3 { transform: rotateY(90deg) translateZ(50px); }
        .cube__face--4 { transform: rotateY(-90deg) translateZ(50px); }
        .cube__face--5 { transform: rotateX(90deg) translateZ(50px); }
        .cube__face--6 { transform: rotateX(-90deg) translateZ(50px); }
        .shadow { position: absolute; bottom: -30px; left: 10px; width: 80px; height: 10px; background: rgba(0,0,0,0.6); border-radius: 50%; filter: blur(5px); transition: 1.5s; }

        /* Animation Classes */
        body.profile-open .avatar {
            transform: scale(4) translateY(45px);
            border-color: transparent;
        }
        body.profile-open #header-balance, body.profile-open #mode-toggle {
            opacity: 0;
            pointer-events: none;
        }

        .back-btn { display: none; }
        body.profile-open .back-btn, body.game-open .back-btn { display: block; }

    </style>
</head>
<body>

    <header>
        <button class="mode-btn" id="mode-toggle" onclick="toggleMode()">–î–µ–º–æ</button>
        
        <div class="profile-trigger" onclick="toggleProfile()">
            <span id="header-balance">1000üç¨</span>
            <img src="https://via.placeholder.com/100?text=?" alt="" id="user-photo" class="avatar">
            <button class="mode-btn back-btn">–ù–∞–∑–∞–¥</button>
        </div>
    </header>

    <div id="menu-screen">
        <div class="game-card">
            <div class="game-preview">üé≤</div>
            <div class="game-info">
                <div class="game-title">–ö—É–±–∏–∫</div>
                <div style="color: var(--text-secondary); font-size: 13px;">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞</div>
            </div>
            <button class="mode-btn" style="background: var(--accent-color); padding: 12px 20px;" onclick="openGame()">–ò–≥—Ä–∞—Ç—å</button>
        </div>
    </div>

    <div id="profile-screen">
        <div class="profile-bg" id="profile-blur-bg"></div>
        <div class="profile-content">
            <span class="user-nick" id="user-nick">@username</span>
            <div class="user-name" id="user-full-name">–ò–≥—Ä–æ–∫</div>
            
            <div class="balance-card">
                <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">–î–ï–ú–û –ë–ê–õ–ê–ù–°</div>
                <div id="demo-val" style="font-size: 24px; font-weight: 800;">1000 üç¨</div>
            </div>
            
            <div class="balance-card">
                <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">–†–ï–ê–õ–¨–ù–´–ô –°–ß–ï–¢</div>
                <div style="font-size: 24px; font-weight: 800;">0.00 $</div>
            </div>
        </div>
    </div>

    <div id="game-screen">
        <div class="jump-box" id="jump-box">
            <div class="shadow" id="shadow"></div>
            <div class="scene">
                <div class="cube" id="cube">
                    <div class="cube__face cube__face--1">1</div>
                    <div class="cube__face cube__face--2">2</div>
                    <div class="cube__face cube__face--3">3</div>
                    <div class="cube__face cube__face--4">4</div>
                    <div class="cube__face cube__face--5">5</div>
                    <div class="cube__face cube__face--6">6</div>
                </div>
            </div>
        </div>
        <button id="roll-button" class="mode-btn" style="margin-top: 80px; padding: 20px 60px; background: var(--accent-color); font-size: 18px;" onclick="rollDice()">–ë–†–û–°–ò–¢–¨ üé≤</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let state = {
            mode: 'demo',
            demoBalance: 1000,
            isProfileOpen: false,
            isGameOpen: false,
            currentRotationX: -20,
            currentRotationY: 20
        };

        // --- –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• –ò–ó –¢–ï–õ–ï–ì–†–ê–ú ---
        function initUserData() {
            const user = tg.initDataUnsafe?.user;
            
            if (user) {
                // –ò–º—è –∏ –§–∞–º–∏–ª–∏—è
                const fullName = [user.first_name, user.last_name].filter(Boolean).join(' ');
                document.getElementById('user-full-name').innerText = fullName || "–ò–≥—Ä–æ–∫";
                
                // –ù–∏–∫–Ω–µ–π–º (@username)
                if (user.username) {
                    document.getElementById('user-nick').innerText = `@${user.username}`;
                } else {
                    document.getElementById('user-nick').style.display = 'none';
                }

                // –§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è
                if (user.photo_url) {
                    document.getElementById('user-photo').src = user.photo_url;
                    document.getElementById('profile-blur-bg').style.backgroundImage = `url(${user.photo_url})`;
                }
            }
        }

        initUserData();

        // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---
        function toggleMode() {
            state.mode = state.mode === 'demo' ? 'real' : 'demo';
            document.getElementById('mode-toggle').innerText = state.mode === 'demo' ? '–î–µ–º–æ' : '–ë–∞–ª–∞–Ω—Å';
            updateBalanceUI();
            tg.HapticFeedback.selectionChanged();
        }

        function updateBalanceUI() {
            const display = state.mode === 'demo' ? `${state.demoBalance}üç¨` : `0.00$`;
            document.getElementById('header-balance').innerText = display;
            document.getElementById('demo-val').innerText = `${state.demoBalance} üç¨`;
        }

        function toggleProfile() {
            if (state.isGameOpen) { closeGame(); return; }
            
            state.isProfileOpen = !state.isProfileOpen;
            const profile = document.getElementById('profile-screen');
            const menu = document.getElementById('menu-screen');
            
            if (state.isProfileOpen) {
                document.body.classList.add('profile-open');
                profile.style.opacity = '1';
                profile.style.pointerEvents = 'all';
                menu.style.opacity = '0';
            } else {
                document.body.classList.remove('profile-open');
                profile.style.opacity = '0';
                profile.style.pointerEvents = 'none';
                menu.style.opacity = '1';
            }
            tg.HapticFeedback.impactOccurred('light');
        }

        function openGame() {
            state.isGameOpen = true;
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            document.body.classList.add('game-open');
            tg.HapticFeedback.impactOccurred('medium');
        }

        function closeGame() {
            state.isGameOpen = false;
            document.getElementById('menu-screen').style.display = 'block';
            document.getElementById('game-screen').style.display = 'none';
            document.body.classList.remove('game-open');
            document.querySelectorAll('.cube__face').forEach(f => f.classList.remove('winner'));
        }

        // --- –õ–û–ì–ò–ö–ê –ö–£–ë–ò–ö–ê ---
        function rollDice() {
            const btn = document.getElementById('roll-button');
            if (btn.disabled) return;

            if (state.mode === 'demo') {
                if (state.demoBalance > 100) {
                    state.demoBalance -= 10;
                    updateBalanceUI();
                }
            }

            btn.disabled = true;
            document.querySelectorAll('.cube__face').forEach(f => f.classList.remove('winner'));

            const result = Math.floor(Math.random() * 6) + 1;
            const rots = { 1:{x:0,y:0}, 2:{x:0,y:180}, 3:{x:0,y:-90}, 4:{x:0,y:90}, 5:{x:-90,y:0}, 6:{x:90,y:0} };
            
            state.currentRotationX += 1440 + (rots[result].x - (state.currentRotationX % 360));
            state.currentRotationY += 1440 + (rots[result].y - (state.currentRotationY % 360));

            const jumpBox = document.getElementById('jump-box');
            const cube = document.getElementById('cube');
            const shadow = document.getElementById('shadow');

            jumpBox.style.transform = 'translateY(-180px) scale(1.1)';
            shadow.style.transform = 'scale(0.3)';
            shadow.style.opacity = '0.2';
            cube.style.transform = `rotateX(${state.currentRotationX}deg) rotateY(${state.currentRotationY}deg)`;

            setTimeout(() => {
                jumpBox.style.transform = 'translateY(0) scale(1)';
                shadow.style.transform = 'scale(1)';
                shadow.style.opacity = '0.7';
            }, 750);

            setTimeout(() => {
                document.querySelector(`.cube__face--${result}`).classList.add('winner');
                tg.HapticFeedback.notificationOccurred('success');
                btn.disabled = false;
            }, 1500);
        }
    </script>
</body>
</html>
