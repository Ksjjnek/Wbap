<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NovaChat</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { font-family: Arial; background:#0f172a; color:white; margin:0; text-align:center; }
#registration, #chat { display:none; height:100vh; flex-direction:column; }
#start { display:none; margin-top:150px; }
button { padding:15px 30px; font-size:18px; border:none; border-radius:10px; background:#3b82f6; color:white; cursor:pointer; }
#messages { flex:1; overflow:auto; padding:20px; text-align:left; }
#input { display:flex; padding:10px; background:#1e293b; }
#input input { flex:1; padding:10px; border:none; border-radius:8px; }
#input button { margin-left:10px; }
h2 { margin-top:30px; }
</style>
</head>
<body>

<div id="start">
  <h1>NovaChat üí¨</h1>
  <p>–ù–∞–∂–º–∏—Ç–µ START, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
  <button onclick="openRegistration()">START</button>
</div>

<div id="registration">
  <h2>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏–∫ –¥–ª—è —á–∞—Ç–∞</h2>
  <input id="nickname" placeholder="–í–∞—à –Ω–∏–∫" style="padding:10px; font-size:16px;">
  <button onclick="register()">–í–æ–π—Ç–∏ –≤ —á–∞—Ç</button>
</div>

<div id="chat">
  <div id="messages"></div>
  <div id="input">
    <input id="text" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ">
    <button onclick="send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const ALLOWED_BOT_ID = 8250250632; // —Ç–≤–æ–π –±–æ—Ç

// –†–∞–Ω–¥–æ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
const registerMessages = [
  "–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è!",
  "—Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–ª –Ω–∏–∫!",
  "–≥–æ—Ç–æ–≤ –∫ –æ–±—â–µ–Ω–∏—é!",
  "–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ —á–∞—Ç—É!"
];

let nickname = null;

// ----------------------
// –¢—â–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Telegram
// ----------------------
function checkTelegramAccess() {
    if(!tg.initData || !tg.initDataUnsafe){
        return false;
    }
    const user = tg.initDataUnsafe.user;
    const botId = tg.initDataUnsafe.bot_id;
    if(!user || !botId){
        return false;
    }
    if(botId != ALLOWED_BOT_ID){
        return false;
    }
    return true;
}

if(!checkTelegramAccess()){
    document.body.innerHTML = "<h2 style='color:red; margin-top:50px;'>‚ùå –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞</h2>";
} else {
    document.getElementById("start").style.display = "block";
}

// ----------------------
// –§—É–Ω–∫—Ü–∏–∏
// ----------------------
function openRegistration(){
    document.getElementById("start").style.display="none";
    document.getElementById("registration").style.display="block";
}

function register(){
    const nickInput = document.getElementById("nickname").value.trim();
    if(nickInput === ""){
        alert("–ù–∏–∫ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω");
        return;
    }
    nickname = nickInput;

    const showAnnouncement = confirm("–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –æ –≤–∞—à–µ–º –≤—Ö–æ–¥–µ –≤ —á–∞—Ç –±—ã–ª–æ –æ–±—ä—è–≤–ª–µ–Ω–æ?");
    document.getElementById("registration").style.display="none";
    document.getElementById("chat").style.display="flex";

    if(showAnnouncement){
        const msg = registerMessages[Math.floor(Math.random()*registerMessages.length)];
        addMessage("–°–∏—Å—Ç–µ–º–∞", `${nickname} ${msg}`);
        tg.sendData(`SYSTEM_ANNOUNCE: ${nickname} ${msg}`);
    }
}

function send(){
    const textInput = document.getElementById("text");
    let text = textInput.value.trim();
    if(!text || !nickname) return;
    addMessage(nickname, text);
    textInput.value="";
    tg.sendData(text);
}

function addMessage(name,text){
    const msg = document.createElement("div");
    msg.innerHTML = `<b>${name}:</b> ${text}`;
    document.getElementById("messages").appendChild(msg);
    document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
}
</script>
</body>
</html>
